[{"name": "app.py", "content": "{\n \"cells\": [\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {\n    \"id\": \"jHLGVoh8NJLK\"\n   },\n   \"source\": [\n    \"**Programa para el env\u00edo masivo de recibos de mantenimiento por correo**\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": null,\n   \"metadata\": {\n    \"colab\": {\n     \"base_uri\": \"https://localhost:8080/\"\n    },\n    \"executionInfo\": {\n     \"elapsed\": 12596,\n     \"status\": \"ok\",\n     \"timestamp\": 1760076428577,\n     \"user\": {\n      \"displayName\": \"Mirador Venezuela\",\n      \"userId\": \"17997044465119919784\"\n     },\n     \"user_tz\": 300\n    },\n    \"id\": \"zRbRRJB5Hggm\",\n    \"outputId\": \"8c029525-bc97-43a6-fa13-8ebb1ac9cf2b\"\n   },\n   \"outputs\": [\n    {\n     \"name\": \"stdout\",\n     \"output_type\": \"stream\",\n     \"text\": [\n      \"Requirement already satisfied: PyPDF2 in /usr/local/lib/python3.12/dist-packages (3.0.1)\\n\",\n      \"Requirement already satisfied: pandas in /usr/local/lib/python3.12/dist-packages (2.2.2)\\n\",\n      \"Requirement already satisfied: numpy>=1.26.0 in /usr/local/lib/python3.12/dist-packages (from pandas) (2.0.2)\\n\",\n      \"Requirement already satisfied: python-dateutil>=2.8.2 in /usr/local/lib/python3.12/dist-packages (from pandas) (2.9.0.post0)\\n\",\n      \"Requirement already satisfied: pytz>=2020.1 in /usr/local/lib/python3.12/dist-packages (from pandas) (2025.2)\\n\",\n      \"Requirement already satisfied: tzdata>=2022.7 in /usr/local/lib/python3.12/dist-packages (from pandas) (2025.2)\\n\",\n      \"Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.12/dist-packages (from python-dateutil>=2.8.2->pandas) (1.17.0)\\n\",\n      \"Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(\\\"/content/drive\\\", force_remount=True).\\n\"\n     ]\n    }\n   ],\n   \"source\": [\n    \"!pip install PyPDF2 pandas\\n\",\n    \"import os\\n\",\n    \"import re\\n\",\n    \"import pandas as pd\\n\",\n    \"from PyPDF2 import PdfReader, PdfWriter\\n\",\n    \"from google.colab import drive\\n\",\n    \"from datetime import datetime\\n\",\n    \"import time\\n\",\n    \"import smtplib\\n\",\n    \"from email.mime.multipart import MIMEMultipart\\n\",\n    \"from email.mime.text import MIMEText\\n\",\n    \"from email.mime.application import MIMEApplication\\n\",\n    \"from email.utils import formatdate\\n\",\n    \"import traceback\\n\",\n    \"\\n\",\n    \"# Montar Google Drive\\n\",\n    \"drive.mount('/content/drive')\\n\",\n    \"base_path = '/content/drive/MyDrive/Condominio El Mirador I/RECIBOS 2025/Programa de env\u00edo masivo de correos' #Tu ruta\\n\",\n    \"\\n\",\n    \"# Crear carpetas base si no existen\\n\",\n    \"os.makedirs(f'{base_path}/Recibos_Origen', exist_ok=True)\\n\",\n    \"os.makedirs(f'{base_path}/Recibos_Individuales', exist_ok=True)\\n\",\n    \"os.makedirs(f'{base_path}/Base_Datos', exist_ok=True)\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 38,\n   \"metadata\": {\n    \"colab\": {\n     \"base_uri\": \"https://localhost:8080/\"\n    },\n    \"executionInfo\": {\n     \"elapsed\": 7909,\n     \"status\": \"ok\",\n     \"timestamp\": 1760076449277,\n     \"user\": {\n      \"displayName\": \"Mirador Venezuela\",\n      \"userId\": \"17997044465119919784\"\n     },\n     \"user_tz\": 300\n    },\n    \"id\": \"oz6T6Zc9h0mV\",\n    \"outputId\": \"9d88ea7e-8fa6-4e56-c375-2150ded297dd\"\n   },\n   \"outputs\": [\n    {\n     \"name\": \"stdout\",\n     \"output_type\": \"stream\",\n     \"text\": [\n      \"\ud83d\udfe2 BLOQUE 1: Configuraci\u00f3n inicial\\n\",\n      \"Ingrese el mes (ej: Julio): Septiembre\\n\",\n      \"Ingrese el a\u00f1o (ej: 2025): 2025\\n\",\n      \"\u2705 Periodo configurado: Septiembre 2025\\n\",\n      \"\ud83d\udcc1 Carpeta creada: /content/drive/MyDrive/Condominio El Mirador I/RECIBOS 2025/Programa de env\u00edo masivo de correos/Recibos_Individuales/Septiembre_2025/\\n\"\n     ]\n    }\n   ],\n   \"source\": [\n    \"# BLOQUE 1: CONFIGURACI\u00d3N INICIAL\\n\",\n    \"# ============================================\\n\",\n    \"print(\\\"\ud83d\udfe2 BLOQUE 1: Configuraci\u00f3n inicial\\\")\\n\",\n    \"mes = input(\\\"Ingrese el mes (ej: Julio): \\\").strip().capitalize()\\n\",\n    \"a\u00f1o = input(\\\"Ingrese el a\u00f1o (ej: 2025): \\\").strip()\\n\",\n    \"periodo = f\\\"{mes}_{a\u00f1o}\\\"\\n\",\n    \"\\n\",\n    \"# Crear carpeta para el periodo\\n\",\n    \"periodo_folder = f'{base_path}/Recibos_Individuales/{periodo}/'\\n\",\n    \"os.makedirs(periodo_folder, exist_ok=True)\\n\",\n    \"print(f\\\"\u2705 Periodo configurado: {mes} {a\u00f1o}\\\")\\n\",\n    \"print(f\\\"\ud83d\udcc1 Carpeta creada: {periodo_folder}\\\")\\n\",\n    \"\\n\",\n    \"# Ruta del archivo Excel\\n\",\n    \"db_path = f'{base_path}/Base_Datos/base_datos.xlsx'\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 39,\n   \"metadata\": {\n    \"colab\": {\n     \"base_uri\": \"https://localhost:8080/\"\n    },\n    \"executionInfo\": {\n     \"elapsed\": 6678,\n     \"status\": \"ok\",\n     \"timestamp\": 1760076484614,\n     \"user\": {\n      \"displayName\": \"Mirador Venezuela\",\n      \"userId\": \"17997044465119919784\"\n     },\n     \"user_tz\": 300\n    },\n    \"id\": \"SiMfcZj6jQTK\",\n    \"outputId\": \"27096da8-555e-47a2-f469-5609909ec124\"\n   },\n   \"outputs\": [\n    {\n     \"name\": \"stdout\",\n     \"output_type\": \"stream\",\n     \"text\": [\n      \"\\n\",\n      \"\ud83d\udfe2 BLOQUE 2: Extraer recibos individuales\\n\",\n      \"\ud83d\udcc4 Procesando archivo: SETIEMBRE 2025.xlsx - RECIBOS.pdf\\n\",\n      \"\ud83d\udd22 Total de p\u00e1ginas: 126\\n\",\n      \"\u2705 101A \u2705 503A \u2705 903A \u2705 1303A \u2705 303B \u2705 703B \u2705 1103B \u2705 102A \u2705 504A \u2705 904A \u2705 1304A \u2705 304B \u2705 704B \u2705 1104B \u2705 201A \u2705 601A \u2705 1001A \u2705 1401A \u2705 401B \u2705 801B \u2705 1201B \u2705 202A \u2705 602A \u2705 1002A \u2705 1402A \u2705 402B \u2705 802B \u2705 1202B \u2705 203A \u2705 603A \u2705 1003A \u2705 1403A \u2705 403B \u2705 803B \u2705 1203B \u2705 204A \u2705 604A \u2705 1004A \u2705 1404A \u2705 404B \u2705 804B \u2705 1204B \u2705 301A \u2705 701A \u2705 1101A \u2705 101B \u2705 501B \u2705 901B \u2705 1301B \u2705 302A \u2705 702A \u2705 1102A \u2705 102B \u2705 502B \u2705 902B \u2705 1302B \u2705 303A \u2705 703A \u2705 1103A \u2705 103B \u2705 503B \u2705 903B \u2705 1303B \u2705 304A \u2705 704A \u2705 1104A \u2705 104B \u2705 504B \u2705 904B \u2705 1304B \u2705 401A \u2705 801A \u2705 1201A \u2705 201B \u2705 601B \u2705 1001B \u2705 1401B \u2705 402A \u2705 802A \u2705 1202A \u2705 202B \u2705 602B \u2705 1002B \u2705 1402B \u2705 403A \u2705 803A \u2705 1203A \u2705 203B \u2705 603B \u2705 1003B \u2705 1403B \u2705 404A \u2705 804A \u2705 1204A \u2705 204B \u2705 604B \u2705 1004B \u2705 1404B \u2705 501A \u2705 901A \"\n     ]\n    },\n    {\n     \"name\": \"stderr\",\n     \"output_type\": \"stream\",\n     \"text\": [\n      \"WARNING:PyPDF2.generic._base:FloatObject (b'0.00000000000-11368684') invalid; use 0.0 instead\\n\",\n      \"WARNING:PyPDF2.generic._base:FloatObject (b'0.00000000000-9094947') invalid; use 0.0 instead\\n\",\n      \"WARNING:PyPDF2.generic._base:FloatObject (b'0.00000000000-9094947') invalid; use 0.0 instead\\n\",\n      \"WARNING:PyPDF2.generic._base:FloatObject (b'0.00000000000-11368684') invalid; use 0.0 instead\\n\",\n      \"WARNING:PyPDF2.generic._base:FloatObject (b'0.00000000000-11368684') invalid; use 0.0 instead\\n\",\n      \"WARNING:PyPDF2.generic._base:FloatObject (b'0.00000000000-9094947') invalid; use 0.0 instead\\n\",\n      \"WARNING:PyPDF2.generic._base:FloatObject (b'0.00000000000-11368684') invalid; use 0.0 instead\\n\",\n      \"WARNING:PyPDF2.generic._base:FloatObject (b'0.00000000000-11368684') invalid; use 0.0 instead\\n\",\n      \"WARNING:PyPDF2.generic._base:FloatObject (b'0.00000000000-9094947') invalid; use 0.0 instead\\n\",\n      \"WARNING:PyPDF2.generic._base:FloatObject (b'0.00000000000-9094947') invalid; use 0.0 instead\\n\",\n      \"WARNING:PyPDF2.generic._base:FloatObject (b'0.00000000000-11368684') invalid; use 0.0 instead\\n\",\n      \"WARNING:PyPDF2.generic._base:FloatObject (b'0.00000000000-11368684') invalid; use 0.0 instead\\n\",\n      \"WARNING:PyPDF2.generic._base:FloatObject (b'0.00000000000-9094947') invalid; use 0.0 instead\\n\",\n      \"WARNING:PyPDF2.generic._base:FloatObject (b'0.00000000000-9094947') invalid; use 0.0 instead\\n\"\n     ]\n    },\n    {\n     \"name\": \"stdout\",\n     \"output_type\": \"stream\",\n     \"text\": [\n      \"\u2705 1301A \u2705 301B \u2705 701B \u2705 1101B \u2705 502A \u2705 902A \u2705 1302A \u2705 302B \u2705 702B \u2705 1102B \\n\",\n      \"\\n\",\n      \"\ud83d\udcc1 Total departamentos procesados: 110\\n\",\n      \"\ud83d\udccd Recibos guardados en: /content/drive/MyDrive/Condominio El Mirador I/RECIBOS 2025/Programa de env\u00edo masivo de correos/Recibos_Individuales/Septiembre_2025/\\n\"\n     ]\n    }\n   ],\n   \"source\": [\n    \"# ============================================\\n\",\n    \"# BLOQUE 2: EXTRAER RECIBOS INDIVIDUALES\\n\",\n    \"# ============================================\\n\",\n    \"print(\\\"\\\\n\ud83d\udfe2 BLOQUE 2: Extraer recibos individuales\\\")\\n\",\n    \"\\n\",\n    \"# Buscar archivo PDF en Recibos_Origen\\n\",\n    \"pdf_files = [f for f in os.listdir(f'{base_path}/Recibos_Origen') if f.lower().endswith('.pdf')]\\n\",\n    \"if not pdf_files:\\n\",\n    \"    print(\\\"\u26a0\ufe0f Error: No se encontraron archivos PDF en Recibos_Origen\\\")\\n\",\n    \"    print(\\\"Por favor sube el archivo PDF y vuelve a ejecutar este bloque\\\")\\n\",\n    \"else:\\n\",\n    \"    input_pdf = f'{base_path}/Recibos_Origen/{pdf_files[0]}'\\n\",\n    \"    print(f\\\"\ud83d\udcc4 Procesando archivo: {pdf_files[0]}\\\")\\n\",\n    \"\\n\",\n    \"    with open(input_pdf, 'rb') as file:\\n\",\n    \"        reader = PdfReader(file)\\n\",\n    \"        total_pages = len(reader.pages)\\n\",\n    \"        print(f\\\"\ud83d\udd22 Total de p\u00e1ginas: {total_pages}\\\")\\n\",\n    \"\\n\",\n    \"        departamentos_procesados = []\\n\",\n    \"\\n\",\n    \"        for page_num in range(total_pages):\\n\",\n    \"            page = reader.pages[page_num]\\n\",\n    \"            text = page.extract_text()\\n\",\n    \"\\n\",\n    \"            # Buscar patr\u00f3n de departamento (ej: 701B)\\n\",\n    \"            dpto_match = re.search(r'(\\\\d+[AB])\\\\s*$', text, re.MULTILINE)\\n\",\n    \"\\n\",\n    \"            if dpto_match:\\n\",\n    \"                dpto = dpto_match.group(1)\\n\",\n    \"                writer = PdfWriter()\\n\",\n    \"                writer.add_page(page)\\n\",\n    \"\\n\",\n    \"                # Guardar como PDF individual\\n\",\n    \"                output_pdf = f'{periodo_folder}{dpto}.pdf'\\n\",\n    \"                with open(output_pdf, 'wb') as output_file:\\n\",\n    \"                    writer.write(output_file)\\n\",\n    \"\\n\",\n    \"                departamentos_procesados.append(dpto)\\n\",\n    \"                print(f\\\"\u2705 {dpto}\\\", end=' ', flush=True)\\n\",\n    \"\\n\",\n    \"        print(f\\\"\\\\n\\\\n\ud83d\udcc1 Total departamentos procesados: {len(departamentos_procesados)}\\\")\\n\",\n    \"        print(f\\\"\ud83d\udccd Recibos guardados en: {periodo_folder}\\\")\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 40,\n   \"metadata\": {\n    \"colab\": {\n     \"base_uri\": \"https://localhost:8080/\"\n    },\n    \"executionInfo\": {\n     \"elapsed\": 404,\n     \"status\": \"ok\",\n     \"timestamp\": 1760076568701,\n     \"user\": {\n      \"displayName\": \"Mirador Venezuela\",\n      \"userId\": \"17997044465119919784\"\n     },\n     \"user_tz\": 300\n    },\n    \"id\": \"26Z7OkVrjVHp\",\n    \"outputId\": \"92291848-0435-46b9-e67f-ff541ab8f59a\"\n   },\n   \"outputs\": [\n    {\n     \"name\": \"stdout\",\n     \"output_type\": \"stream\",\n     \"text\": [\n      \"\\n\",\n      \"\ud83d\udfe2 BLOQUE 3: Verificar base de datos\\n\",\n      \"\ud83d\udd0d Base de datos existente cargada\\n\",\n      \"Columnas detectadas: ['DPTO', 'NOMBRES Y APELLIDOS', 'DOCUMENTO DE IDENTIDAD', 'CORREO_1', 'CELULAR_1', 'CORREO_2', 'CELULAR_2', 'COCHERA', 'MASCOTAS', 'OBSERVACION', 'NOMBRE_ARCHIVO']\\n\",\n      \"\u21aa\ufe0f Columnas renombradas: {'DPTO': 'Departamento', 'NOMBRES Y APELLIDOS': 'Propietario', 'CORREO_1': 'Email', 'CORREO_2': 'Email_CC', 'NOMBRE_ARCHIVO': 'Archivo_PDF'}\\n\",\n      \"\\n\",\n      \"\ud83d\udcca Vista previa de la base de datos (primeras 5 filas):\\n\",\n      \"Departamento                      Propietario DOCUMENTO DE IDENTIDAD                    Email   CELULAR_1 Email_CC   CELULAR_2 COCHERA MASCOTAS OBSERVACION Archivo_PDF\\n\",\n      \"        101A MIRTHA RAFAELA VILCABANA OCHANTE               43368397                      NaN   924309163      NaN         NaN     NaN      NaN         NaN    101A.pdf\\n\",\n      \"        102A     MIRTA JESSICA MONROY CARNERO               74648205                      NaN 987 751 256      NaN 982313748.0     NaN      NaN         NaN    102A.pdf\\n\",\n      \"        201A        JESSICA ALTAMIRANO AG\u00dcERO               40697400    jennysentir@gmail.com   999905726      NaN         NaN     NaN       No         NaN    201A.pdf\\n\",\n      \"        202A      LUISA CRISTINA NARVAEZ ANZA                    NaN kelly.canturin@gmail.com         NaN      NaN 993600551.0     NaN      NaN         NaN    202A.pdf\\n\",\n      \"        203A      JULIO CESAR CABRERA DELGADO               09916885                      NaN   914397416      NaN 994230624.0     NaN      NaN         NaN    203A.pdf\\n\",\n      \"\\n\",\n      \"\ud83d\udd0d Verificaci\u00f3n de datos:\\n\",\n      \"- Total registros: 110\\n\",\n      \"- Emails no vac\u00edos: 102\\n\",\n      \"- Archivos PDF asignados: 110\\n\"\n     ]\n    }\n   ],\n   \"source\": [\n    \"# ============================================\\n\",\n    \"# BLOQUE 3: VERIFICAR BASE DE DATOS\\n\",\n    \"# ============================================\\n\",\n    \"print(\\\"\\\\n\ud83d\udfe2 BLOQUE 3: Verificar base de datos\\\")\\n\",\n    \"\\n\",\n    \"# Cargar base de datos\\n\",\n    \"if os.path.exists(db_path):\\n\",\n    \"    try:\\n\",\n    \"        # Leer Excel con encabezado en la primera fila\\n\",\n    \"        df = pd.read_excel(db_path)\\n\",\n    \"        print(\\\"\ud83d\udd0d Base de datos existente cargada\\\")\\n\",\n    \"\\n\",\n    \"        # Verificar estructura\\n\",\n    \"        print(\\\"Columnas detectadas:\\\", df.columns.tolist())\\n\",\n    \"\\n\",\n    \"        # Renombrar columnas a nombres estandarizados\\n\",\n    \"        rename_map = {}\\n\",\n    \"        column_mapping = {\\n\",\n    \"            'DPTO': 'Departamento',\\n\",\n    \"            'NOMBRES Y APELLIDOS': 'Propietario',\\n\",\n    \"            'CORREO_1': 'Email',\\n\",\n    \"            'CORREO_2': 'Email_CC',\\n\",\n    \"            'NOMBRE_ARCHIVO': 'Archivo_PDF'\\n\",\n    \"        }\\n\",\n    \"\\n\",\n    \"        for original, nuevo in column_mapping.items():\\n\",\n    \"            if original in df.columns:\\n\",\n    \"                rename_map[original] = nuevo\\n\",\n    \"\\n\",\n    \"        if rename_map:\\n\",\n    \"            df = df.rename(columns=rename_map)\\n\",\n    \"            print(f\\\"\u21aa\ufe0f Columnas renombradas: {rename_map}\\\")\\n\",\n    \"\\n\",\n    \"        # Verificar si existen todas las columnas necesarias\\n\",\n    \"        required_columns = ['Departamento', 'Propietario', 'Email', 'Archivo_PDF']\\n\",\n    \"        missing_cols = [col for col in required_columns if col not in df.columns]\\n\",\n    \"\\n\",\n    \"        if missing_cols:\\n\",\n    \"            print(f\\\"\u26a0\ufe0f Advertencia: Faltan columnas: {', '.join(missing_cols)}\\\")\\n\",\n    \"\\n\",\n    \"            # A\u00f1adir columnas faltantes\\n\",\n    \"            for col in missing_cols:\\n\",\n    \"                if col not in df.columns:\\n\",\n    \"                    df[col] = ''\\n\",\n    \"                    print(f\\\"\u2795 Columna '{col}' a\u00f1adida\\\")\\n\",\n    \"    except Exception as e:\\n\",\n    \"        print(f\\\"\u274c Error al cargar la base de datos: {str(e)}\\\")\\n\",\n    \"        exit()\\n\",\n    \"else:\\n\",\n    \"    print(\\\"\u274c Error: No se encontr\u00f3 la base de datos\\\")\\n\",\n    \"    exit()\\n\",\n    \"\\n\",\n    \"# Mostrar vista previa detallada\\n\",\n    \"print(\\\"\\\\n\ud83d\udcca Vista previa de la base de datos (primeras 5 filas):\\\")\\n\",\n    \"print(df.head().to_string(index=False))\\n\",\n    \"\\n\",\n    \"print(\\\"\\\\n\ud83d\udd0d Verificaci\u00f3n de datos:\\\")\\n\",\n    \"print(f\\\"- Total registros: {len(df)}\\\")\\n\",\n    \"print(f\\\"- Emails no vac\u00edos: {df['Email'].notna().sum()}\\\")\\n\",\n    \"print(f\\\"- Archivos PDF asignados: {df['Archivo_PDF'].notna().sum()}\\\")\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": null,\n   \"metadata\": {\n    \"colab\": {\n     \"base_uri\": \"https://localhost:8080/\",\n     \"height\": 1000\n    },\n    \"executionInfo\": {\n     \"elapsed\": 70896,\n     \"status\": \"error\",\n     \"timestamp\": 1760076746637,\n     \"user\": {\n      \"displayName\": \"Mirador Venezuela\",\n      \"userId\": \"17997044465119919784\"\n     },\n     \"user_tz\": 300\n    },\n    \"id\": \"3dnm9Wx2jYst\",\n    \"outputId\": \"db36a168-1d5c-4385-8ba1-7f0492e11856\"\n   },\n   \"outputs\": [\n    {\n     \"name\": \"stdout\",\n     \"output_type\": \"stream\",\n     \"text\": [\n      \"\\n\",\n      \"\ud83d\udfe2 BLOQUE 4: Enviar correos\\n\",\n      \"\\n\",\n      \"\ud83e\uddf9 Realizando limpieza de datos...\\n\",\n      \"\\n\",\n      \"\ud83d\udcca RESUMEN DE DATOS:\\n\",\n      \"\ud83d\udccb Total registros: 110\\n\",\n      \"\u2709\ufe0f  Correos v\u00e1lidos: 102\\n\",\n      \"\u26a0\ufe0f  Correos inv\u00e1lidos: 8\\n\",\n      \"\\n\",\n      \"\u2705 Primeros 5 correos v\u00e1lidos:\\n\",\n      \"Departamento                    Propietario                    Email               Email_CC\\n\",\n      \"        201A      JESSICA ALTAMIRANO AG\u00dcERO    jennysentir@gmail.com                       \\n\",\n      \"        202A    LUISA CRISTINA NARVAEZ ANZA kelly.canturin@gmail.com                       \\n\",\n      \"        204A       YVAN LUIS SAYBAY COTRINA       ylsaybay@gmail.com                       \\n\",\n      \"        301A   ROSANA MARIA ROMERO PINILLOS      tanarp1@hotmail.com                       \\n\",\n      \"        302A SILVIA DEL ROSARIO AVALOS TASA  silvia.1706@hotmail.com Vivilorena93@gmail.com\\n\",\n      \"\ud83d\udccb Rango de departamentos: 201A a 1404B\\n\",\n      \"Ingrese el departamento desde el cual comenzar el env\u00edo\\n\",\n      \"(ejemplo: 101A para empezar desde el inicio, o 601A para continuar): 601A\\n\",\n      \"\u2705 Departamento encontrado: 601A\\n\",\n      \"\\n\",\n      \"\ud83d\ude80 INICIANDO ENV\u00cdO DESDE: 601A\\n\",\n      \"\ud83d\udce7 Total de correos a enviar: 87\\n\",\n      \"\\n\",\n      \"\ud83d\udccb Primeros 3 departamentos en la cola de env\u00edo:\\n\",\n      \"   1. 601A - FELIPE JARAMILLO CAPITAN\\n\",\n      \"   2. 602A - H\u00c9CTOR RODOLFO CARRI\u00d3N RIVEROS\\n\",\n      \"   3. 603A - CESAR ALTAMIRANO GUEVARA\\n\",\n      \"\\n\",\n      \"\ud83d\udd10 CONFIGURACI\u00d3N SMTP\\n\",\n      \"\\n\",\n      \"\ud83d\udd0c CONECTANDO CON SERVIDOR SMTP...\\n\",\n      \"\ud83d\udd11 AUTENTICACI\u00d3N EXITOSA\\n\",\n      \"\\n\",\n      \"\u2709\ufe0f INICIANDO ENV\u00cdO DE 87 CORREOS...\\n\",\n      \"\u23f1\ufe0f Pausa entre env\u00edos: 15 segundos\\n\",\n      \"\\n\",\n      \"\u27a1\ufe0f [16/87] Enviando a FELIPE JARAMILLO CAPITAN <yvargasp1@gmail.com>\\n\",\n      \"\ud83d\udcce Adjunto: 601A.pdf\\n\",\n      \"\u2705 ENVIADO (Intento 1/3)\\n\",\n      \"\ud83d\udcec Destinatarios enviados: 1/500\\n\",\n      \"\u23f3 Esperando 15 segundos antes del pr\u00f3ximo env\u00edo...\\n\",\n      \"\\n\",\n      \"\u27a1\ufe0f [17/87] Enviando a H\u00c9CTOR RODOLFO CARRI\u00d3N RIVEROS <hecamore@hotmail.com>\\n\",\n      \"\ud83d\udcce Adjunto: 602A.pdf\\n\",\n      \"\u2705 ENVIADO (Intento 1/3)\\n\",\n      \"\ud83d\udcec Destinatarios enviados: 2/500\\n\",\n      \"\u23f3 Esperando 15 segundos antes del pr\u00f3ximo env\u00edo...\\n\",\n      \"\ud83d\udd12 CONEXI\u00d3N SMTP CERRADA\\n\"\n     ]\n    },\n    {\n     \"ename\": \"KeyboardInterrupt\",\n     \"evalue\": \"\",\n     \"output_type\": \"error\",\n     \"traceback\": [\n      \"\\u001b[0;31m---------------------------------------------------------------------------\\u001b[0m\",\n      \"\\u001b[0;31mKeyboardInterrupt\\u001b[0m                         Traceback (most recent call last)\",\n      \"\\u001b[0;32m/tmp/ipython-input-17117380.py\\u001b[0m in \\u001b[0;36m<cell line: 0>\\u001b[0;34m()\\u001b[0m\\n\\u001b[1;32m    306\\u001b[0m             \\u001b[0;31m# Pausa para evitar sobrecarga\\u001b[0m\\u001b[0;34m\\u001b[0m\\u001b[0;34m\\u001b[0m\\u001b[0m\\n\\u001b[1;32m    307\\u001b[0m             \\u001b[0mprint\\u001b[0m\\u001b[0;34m(\\u001b[0m\\u001b[0;34mf\\\"\u23f3 Esperando {pausa_entre_envios} segundos antes del pr\u00f3ximo env\u00edo...\\\"\\u001b[0m\\u001b[0;34m)\\u001b[0m\\u001b[0;34m\\u001b[0m\\u001b[0;34m\\u001b[0m\\u001b[0m\\n\\u001b[0;32m--> 308\\u001b[0;31m             \\u001b[0mtime\\u001b[0m\\u001b[0;34m.\\u001b[0m\\u001b[0msleep\\u001b[0m\\u001b[0;34m(\\u001b[0m\\u001b[0mpausa_entre_envios\\u001b[0m\\u001b[0;34m)\\u001b[0m\\u001b[0;34m\\u001b[0m\\u001b[0;34m\\u001b[0m\\u001b[0m\\n\\u001b[0m\\u001b[1;32m    309\\u001b[0m \\u001b[0;34m\\u001b[0m\\u001b[0m\\n\\u001b[1;32m    310\\u001b[0m         \\u001b[0;32mexcept\\u001b[0m \\u001b[0msmtplib\\u001b[0m\\u001b[0;34m.\\u001b[0m\\u001b[0mSMTPDataError\\u001b[0m \\u001b[0;32mas\\u001b[0m \\u001b[0me\\u001b[0m\\u001b[0;34m:\\u001b[0m\\u001b[0;34m\\u001b[0m\\u001b[0;34m\\u001b[0m\\u001b[0m\\n\",\n      \"\\u001b[0;31mKeyboardInterrupt\\u001b[0m: \"\n     ]\n    }\n   ],\n   \"source\": [\n    \"# ============================================\\n\",\n    \"# BLOQUE 4: ENVIAR CORREOS\\n\",\n    \"# ============================================\\n\",\n    \"print(\\\"\\\\n\ud83d\udfe2 BLOQUE 4: Enviar correos\\\")\\n\",\n    \"\\n\",\n    \"# Funci\u00f3n para ordenar departamentos en el orden espec\u00edfico\\n\",\n    \"def ordenar_departamentos(df):\\n\",\n    \"    # Definir el orden exacto de los departamentos\\n\",\n    \"    orden_especifico = [\\n\",\n    \"        '101A', '102A', '201A', '202A', '203A', '204A', '301A', '302A', '303A', '304A',\\n\",\n    \"        '401A', '402A', '403A', '404A', '501A', '502A', '503A', '504A', '601A', '602A',\\n\",\n    \"        '603A', '604A', '701A', '702A', '703A', '704A', '801A', '802A', '803A', '804A',\\n\",\n    \"        '901A', '902A', '903A', '904A', '1001A', '1002A', '1003A', '1004A', '1101A', '1102A',\\n\",\n    \"        '1103A', '1104A', '1201A', '1202A', '1203A', '1204A', '1301A', '1302A', '1303A', '1304A',\\n\",\n    \"        '1401A', '1402A', '1403A', '1404A', '101B', '102B', '103B', '104B', '201B', '202B',\\n\",\n    \"        '203B', '204B', '301B', '302B', '303B', '304B', '401B', '402B', '403B', '404B',\\n\",\n    \"        '501B', '502B', '503B', '504B', '601B', '602B', '603B', '604B', '701B', '702B',\\n\",\n    \"        '703B', '704B', '801B', '802B', '803B', '804B', '901B', '902B', '903B', '904B',\\n\",\n    \"        '1001B', '1002B', '1003B', '1004B', '1101B', '1102B', '1103B', '1104B', '1201B', '1202B',\\n\",\n    \"        '1203B', '1204B', '1301B', '1302B', '1303B', '1304B', '1401B', '1402B', '1403B', '1404B'\\n\",\n    \"    ]\\n\",\n    \"\\n\",\n    \"    # Crear un diccionario de mapeo de departamento a posici\u00f3n\\n\",\n    \"    orden_map = {depto: idx for idx, depto in enumerate(orden_especifico)}\\n\",\n    \"\\n\",\n    \"    # Filtrar solo los departamentos que existen en el DataFrame\\n\",\n    \"    df['Departamento'] = df['Departamento'].str.strip().str.upper()\\n\",\n    \"    departamentos_existentes = df['Departamento'].unique()\\n\",\n    \"\\n\",\n    \"    # Ordenar el DataFrame seg\u00fan el orden espec\u00edfico\\n\",\n    \"    df['orden'] = df['Departamento'].map(orden_map)\\n\",\n    \"    df = df.sort_values('orden').drop('orden', axis=1).reset_index(drop=True)\\n\",\n    \"\\n\",\n    \"    return df\\n\",\n    \"\\n\",\n    \"# Funci\u00f3n para seleccionar el departamento\\n\",\n    \"def seleccionar_departamento(df_validos):\\n\",\n    \"    # Ordenar el DataFrame seg\u00fan el orden espec\u00edfico\\n\",\n    \"    df_work = ordenar_departamentos(df_validos)\\n\",\n    \"\\n\",\n    \"    # Mostrar el primer y \u00faltimo departamento disponible como referencia\\n\",\n    \"    primer_depto = df_work.iloc[0]['Departamento']\\n\",\n    \"    ultimo_depto = df_work.iloc[-1]['Departamento']\\n\",\n    \"\\n\",\n    \"    print(f\\\"\ud83d\udccb Rango de departamentos: {primer_depto} a {ultimo_depto}\\\")\\n\",\n    \"\\n\",\n    \"    while True:\\n\",\n    \"        # Pedir al usuario que ingrese el departamento de inicio\\n\",\n    \"        departamento = input(\\n\",\n    \"            \\\"Ingrese el departamento desde el cual comenzar el env\u00edo\\\\n\\\"\\n\",\n    \"            \\\"(ejemplo: 101A para empezar desde el inicio, o 601A para continuar): \\\"\\n\",\n    \"        ).strip().upper()\\n\",\n    \"\\n\",\n    \"        # Si est\u00e1 vac\u00edo, usar el primer departamento\\n\",\n    \"        if not departamento:\\n\",\n    \"            print(f\\\"\u2705 Comenzando desde el primer departamento: {primer_depto}\\\")\\n\",\n    \"            return df_work\\n\",\n    \"\\n\",\n    \"        # Buscar el departamento exacto\\n\",\n    \"        if departamento in df_work['Departamento'].values:\\n\",\n    \"            print(f\\\"\u2705 Departamento encontrado: {departamento}\\\")\\n\",\n    \"            # Encontrar el \u00edndice del departamento\\n\",\n    \"            index_departamento = df_work[df_work['Departamento'] == departamento].index[0]\\n\",\n    \"            return df_work.iloc[index_departamento:]\\n\",\n    \"\\n\",\n    \"        # Si no existe, buscar el siguiente disponible autom\u00e1ticamente\\n\",\n    \"        print(f\\\"\u26a0\ufe0f El departamento '{departamento}' no se encuentra.\\\")\\n\",\n    \"        print(\\\"\ud83d\udd0d Buscando el siguiente departamento disponible...\\\")\\n\",\n    \"\\n\",\n    \"        # Buscar en el orden espec\u00edfico\\n\",\n    \"        orden_especifico = [\\n\",\n    \"            '101A', '102A', '201A', '202A', '203A', '204A', '301A', '302A', '303A', '304A',\\n\",\n    \"            '401A', '402A', '403A', '404A', '501A', '502A', '503A', '504A', '601A', '602A',\\n\",\n    \"            '603A', '604A', '701A', '702A', '703A', '704A', '801A', '802A', '803A', '804A',\\n\",\n    \"            '901A', '902A', '903A', '904A', '1001A', '1002A', '1003A', '1004A', '1101A', '1102A',\\n\",\n    \"            '1103A', '1104A', '1201A', '1202A', '1203A', '1204A', '1301A', '1302A', '1303A', '1304A',\\n\",\n    \"            '1401A', '1402A', '1403A', '1404A', '101B', '102B', '103B', '104B', '201B', '202B',\\n\",\n    \"            '203B', '204B', '301B', '302B', '303B', '304B', '401B', '402B', '403B', '404B',\\n\",\n    \"            '501B', '502B', '503B', '504B', '601B', '602B', '603B', '604B', '701B', '702B',\\n\",\n    \"            '703B', '704B', '801B', '802B', '803B', '804B', '901B', '902B', '903B', '904B',\\n\",\n    \"            '1001B', '1002B', '1003B', '1004B', '1101B', '1102B', '1103B', '1104B', '1201B', '1202B',\\n\",\n    \"            '1203B', '1204B', '1301B', '1302B', '1303B', '1304B', '1401B', '1402B', '1403B', '1404B'\\n\",\n    \"        ]\\n\",\n    \"\\n\",\n    \"        # Encontrar la posici\u00f3n del departamento en el orden espec\u00edfico\\n\",\n    \"        try:\\n\",\n    \"            pos_ingresado = orden_especifico.index(departamento)\\n\",\n    \"        except ValueError:\\n\",\n    \"            # Si no est\u00e1 en la lista, encontrar el primer departamento mayor\\n\",\n    \"            pos_ingresado = -1\\n\",\n    \"\\n\",\n    \"        # Buscar el siguiente departamento disponible\\n\",\n    \"        siguiente_depto = None\\n\",\n    \"        if pos_ingresado >= 0:\\n\",\n    \"            # Buscar desde la posici\u00f3n siguiente\\n\",\n    \"            for depto in orden_especifico[pos_ingresado + 1:]:\\n\",\n    \"                if depto in df_work['Departamento'].values:\\n\",\n    \"                    siguiente_depto = depto\\n\",\n    \"                    break\\n\",\n    \"        else:\\n\",\n    \"            # Buscar el primer departamento mayor al ingresado\\n\",\n    \"            for depto in orden_especifico:\\n\",\n    \"                if depto > departamento and depto in df_work['Departamento'].values:\\n\",\n    \"                    siguiente_depto = depto\\n\",\n    \"                    break\\n\",\n    \"\\n\",\n    \"        if siguiente_depto:\\n\",\n    \"            print(f\\\"\u2705 Continuando desde: {siguiente_depto}\\\")\\n\",\n    \"            index_departamento = df_work[df_work['Departamento'] == siguiente_depto].index[0]\\n\",\n    \"            return df_work.iloc[index_departamento:]\\n\",\n    \"        else:\\n\",\n    \"            # Si no hay departamentos mayores, mostrar mensaje\\n\",\n    \"            print(f\\\"\u274c No hay departamentos despu\u00e9s de '{departamento}'\\\")\\n\",\n    \"            print(\\\"\ud83d\udca1 Por favor ingrese un departamento v\u00e1lido del rango mostrado.\\\")\\n\",\n    \"\\n\",\n    \"# Limpiar y validar emails\\n\",\n    \"print(\\\"\\\\n\ud83e\uddf9 Realizando limpieza de datos...\\\")\\n\",\n    \"df['Email'] = df['Email'].fillna('').astype(str).str.strip()\\n\",\n    \"df['Propietario'] = df['Propietario'].fillna('').astype(str).str.strip()\\n\",\n    \"df['Email_CC'] = df.get('Email_CC', '').fillna('').astype(str).str.strip()\\n\",\n    \"\\n\",\n    \"# Filtrar registros con email v\u00e1lido\\n\",\n    \"email_mask = (df['Email'] != '') & (df['Email'].str.contains('@', na=False))\\n\",\n    \"df_validos = df[email_mask].copy()\\n\",\n    \"emails_invalidos = df[~email_mask]\\n\",\n    \"\\n\",\n    \"# Imprimir resumen de los datos\\n\",\n    \"print(\\\"\\\\n\ud83d\udcca RESUMEN DE DATOS:\\\")\\n\",\n    \"print(f\\\"\ud83d\udccb Total registros: {len(df)}\\\")\\n\",\n    \"print(f\\\"\u2709\ufe0f  Correos v\u00e1lidos: {len(df_validos)}\\\")\\n\",\n    \"print(f\\\"\u26a0\ufe0f  Correos inv\u00e1lidos: {len(emails_invalidos)}\\\")\\n\",\n    \"\\n\",\n    \"# Mostrar primeros 5 correos v\u00e1lidos para verificaci\u00f3n\\n\",\n    \"if not df_validos.empty:\\n\",\n    \"    print(\\\"\\\\n\u2705 Primeros 5 correos v\u00e1lidos:\\\")\\n\",\n    \"    print(df_validos[['Departamento', 'Propietario', 'Email', 'Email_CC']].head().to_string(index=False))\\n\",\n    \"\\n\",\n    \"if df_validos.empty:\\n\",\n    \"    print(\\\"\\\\n\u274c ERROR: No hay registros con email v\u00e1lido\\\")\\n\",\n    \"    exit()\\n\",\n    \"\\n\",\n    \"# Seleccionar departamento de inicio\\n\",\n    \"df_departamento = seleccionar_departamento(df_validos)\\n\",\n    \"\\n\",\n    \"if df_departamento is not None and not df_departamento.empty:\\n\",\n    \"    primer_depto_envio = df_departamento.iloc[0]['Departamento']\\n\",\n    \"    print(f\\\"\\\\n\ud83d\ude80 INICIANDO ENV\u00cdO DESDE: {primer_depto_envio}\\\")\\n\",\n    \"    print(f\\\"\ud83d\udce7 Total de correos a enviar: {len(df_departamento)}\\\")\\n\",\n    \"\\n\",\n    \"    # Mostrar los primeros 3 departamentos que se enviar\u00e1n\\n\",\n    \"    print(\\\"\\\\n\ud83d\udccb Primeros 3 departamentos en la cola de env\u00edo:\\\")\\n\",\n    \"    for i in range(min(3, len(df_departamento))):\\n\",\n    \"        depto = df_departamento.iloc[i]['Departamento']\\n\",\n    \"        propietario = df_departamento.iloc[i]['Propietario']\\n\",\n    \"        print(f\\\"   {i+1}. {depto} - {propietario}\\\")\\n\",\n    \"else:\\n\",\n    \"    print(\\\"\\\\n\u274c No se pudo determinar desde qu\u00e9 departamento comenzar\\\")\\n\",\n    \"    exit()\\n\",\n    \"\\n\",\n    \"# =============================================================================\\n\",\n    \"# CONFIGURACI\u00d3N Y ENV\u00cdO DE CORREOS\\n\",\n    \"# =============================================================================\\n\",\n    \"\\n\",\n    \"# Configuraci\u00f3n SMTP\\n\",\n    \"print(\\\"\\\\n\ud83d\udd10 CONFIGURACI\u00d3N SMTP\\\")\\n\",\n    \"remitente = #direcci\u00f3n de correo\\n\",\n    \"password =  # Contrase\u00f1a de aplicaci\u00f3n\\n\",\n    \"asunto = f'Recibo de Mantenimiento - {mes} {a\u00f1o}'\\n\",\n    \"\\n\",\n    \"# L\u00edmites y temporizador\\n\",\n    \"limite_destinatarios = 500  # L\u00edmite diario de Gmail\\n\",\n    \"pausa_entre_envios = 15  # Segundos entre env\u00edos\\n\",\n    \"destinatarios_enviados = 0  # Contador de destinatarios\\n\",\n    \"\\n\",\n    \"# Estad\u00edsticas de env\u00edo\\n\",\n    \"exitosos = 0\\n\",\n    \"fallidos = 0\\n\",\n    \"errores_archivos = 0\\n\",\n    \"errores_envio = 0\\n\",\n    \"\\n\",\n    \"try:\\n\",\n    \"    print(\\\"\\\\n\ud83d\udd0c CONECTANDO CON SERVIDOR SMTP...\\\")\\n\",\n    \"    server = smtplib.SMTP('smtp.gmail.com', 587, timeout=30)\\n\",\n    \"    server.starttls()\\n\",\n    \"    server.login(remitente, password)\\n\",\n    \"    print(\\\"\ud83d\udd11 AUTENTICACI\u00d3N EXITOSA\\\")\\n\",\n    \"\\n\",\n    \"    total = len(df_departamento)\\n\",\n    \"    print(f\\\"\\\\n\u2709\ufe0f INICIANDO ENV\u00cdO DE {total} CORREOS...\\\")\\n\",\n    \"    print(f\\\"\u23f1\ufe0f Pausa entre env\u00edos: {pausa_entre_envios} segundos\\\")\\n\",\n    \"\\n\",\n    \"    for index, row in df_departamento.iterrows():\\n\",\n    \"        dpto = row['Departamento']\\n\",\n    \"        propietario = row['Propietario'] or 'propietario'\\n\",\n    \"        email = row['Email']\\n\",\n    \"        email_cc = row.get('Email_CC', '')\\n\",\n    \"        archivo_pdf = row['Archivo_PDF']\\n\",\n    \"        pdf_path = f\\\"{periodo_folder}{archivo_pdf}\\\"\\n\",\n    \"\\n\",\n    \"        print(f\\\"\\\\n\u27a1\ufe0f [{index+1}/{total}] Enviando a {propietario} <{email}>\\\")\\n\",\n    \"        if email_cc:\\n\",\n    \"            print(f\\\"   \ud83d\udce9 CC: {email_cc}\\\")\\n\",\n    \"\\n\",\n    \"        try:\\n\",\n    \"            # Crear mensaje\\n\",\n    \"            msg = MIMEMultipart()\\n\",\n    \"            msg['From'] = remitente\\n\",\n    \"            msg['To'] = email\\n\",\n    \"\\n\",\n    \"            # A\u00f1adir CC si existe\\n\",\n    \"            if email_cc:\\n\",\n    \"                msg['Cc'] = email_cc\\n\",\n    \"\\n\",\n    \"            msg['Subject'] = asunto\\n\",\n    \"            msg['Date'] = formatdate(localtime=True)\\n\",\n    \"\\n\",\n    \"            # Cuerpo personalizado\\n\",\n    \"            cuerpo = f\\\"\\\"\\\"\\n\",\n    \"            Estimado(a) {propietario},\\n\",\n    \"\\n\",\n    \"            Adjunto encontrar\u00e1 el recibo de mantenimiento correspondiente a su departamento {dpto}.\\n\",\n    \"\\n\",\n    \"            Periodo: {mes} {a\u00f1o}\\n\",\n    \"            Fecha de vencimiento: 15 de {mes} (tener en cuenta que, posterior a la fecha, se carga una mora de 15 soles)\\n\",\n    \"\\n\",\n    \"            Saludos cordiales,\\n\",\n    \"            Administraci\u00f3n del Condominio\\n\",\n    \"            \\\"\\\"\\\"\\n\",\n    \"            msg.attach(MIMEText(cuerpo, 'plain'))\\n\",\n    \"\\n\",\n    \"            # Verificar y adjuntar PDF\\n\",\n    \"            if os.path.exists(pdf_path):\\n\",\n    \"                with open(pdf_path, 'rb') as f:\\n\",\n    \"                    part = MIMEApplication(f.read(), Name=archivo_pdf)\\n\",\n    \"\\n\",\n    \"                part.add_header('Content-Disposition', 'attachment',\\n\",\n    \"                               filename=f\\\"Recibo_{dpto}_{mes}_{a\u00f1o}.pdf\\\")\\n\",\n    \"                msg.attach(part)\\n\",\n    \"                print(f\\\"\ud83d\udcce Adjunto: {archivo_pdf}\\\")\\n\",\n    \"            else:\\n\",\n    \"                errores_archivos += 1\\n\",\n    \"                print(f\\\"\u274c ARCHIVO NO ENCONTRADO: {pdf_path}\\\")\\n\",\n    \"                print(\\\"\u26a0\ufe0f Enviando correo sin adjunto...\\\")\\n\",\n    \"\\n\",\n    \"            # Preparar lista de destinatarios (incluyendo CC)\\n\",\n    \"            destinatarios = [email]\\n\",\n    \"            if email_cc:\\n\",\n    \"                # Manejar m\u00faltiples correos en CC (separados por coma o punto y coma)\\n\",\n    \"                cc_list = [e.strip() for e in re.split(r'[;,]\\\\s*', email_cc) if e.strip()]\\n\",\n    \"                destinatarios.extend(cc_list)\\n\",\n    \"\\n\",\n    \"            # Contar destinatarios\\n\",\n    \"            total_destinatarios = len(destinatarios)\\n\",\n    \"            destinatarios_enviados += total_destinatarios\\n\",\n    \"\\n\",\n    \"            # Verificar l\u00edmite diario\\n\",\n    \"            if destinatarios_enviados > limite_destinatarios:\\n\",\n    \"                print(f\\\"\u26d4 L\u00cdMITE DIARIO EXCEDIDO: {destinatarios_enviados}/{limite_destinatarios} destinatarios\\\")\\n\",\n    \"                print(\\\"\ud83d\udca1 Soluciones:\\\")\\n\",\n    \"                print(\\\"- Espera 24 horas para que se reinicie tu cuota\\\")\\n\",\n    \"                print(\\\"- Considera usar un servicio profesional como SendGrid\\\")\\n\",\n    \"                fallidos += 1\\n\",\n    \"                errores_envio += 1\\n\",\n    \"                break\\n\",\n    \"\\n\",\n    \"            # Intentar env\u00edo con reconexi\u00f3n\\n\",\n    \"            for intento in range(1, 4):  # 3 intentos\\n\",\n    \"                try:\\n\",\n    \"                    server.sendmail(remitente, destinatarios, msg.as_string())\\n\",\n    \"                    exitosos += 1\\n\",\n    \"                    print(f\\\"\u2705 ENVIADO (Intento {intento}/3)\\\")\\n\",\n    \"                    print(f\\\"\ud83d\udcec Destinatarios enviados: {destinatarios_enviados}/{limite_destinatarios}\\\")\\n\",\n    \"                    break\\n\",\n    \"                except smtplib.SMTPDataError as e:\\n\",\n    \"                    if \\\"Daily user sending limit exceeded\\\" in str(e):\\n\",\n    \"                        print(\\\"\u26d4 L\u00cdMITE DIARIO EXCEDIDO\\\")\\n\",\n    \"                        print(\\\"\ud83d\udca1 Por favor usa una cuenta de G Suite o intenta ma\u00f1ana\\\")\\n\",\n    \"                        fallidos += 1\\n\",\n    \"                        errores_envio += 1\\n\",\n    \"                        # Salir completamente del proceso\\n\",\n    \"                        raise\\n\",\n    \"                    else:\\n\",\n    \"                        if intento < 3:\\n\",\n    \"                            print(f\\\"\u26a0\ufe0f Error en env\u00edo. Reintentando... ({str(e)})\\\")\\n\",\n    \"                            time.sleep(5)  # Esperar antes de reintentar\\n\",\n    \"                            continue\\n\",\n    \"                        else:\\n\",\n    \"                            raise\\n\",\n    \"                except smtplib.SMTPServerDisconnected:\\n\",\n    \"                    if intento < 3:\\n\",\n    \"                        print(f\\\"\u26a0\ufe0f Desconectado. Reconectando... (Intento {intento+1}/3)\\\")\\n\",\n    \"                        server.connect('smtp.gmail.com', 587)\\n\",\n    \"                        server.starttls()\\n\",\n    \"                        server.login(remitente, password)\\n\",\n    \"                        continue\\n\",\n    \"                    else:\\n\",\n    \"                        raise\\n\",\n    \"                except Exception as e:\\n\",\n    \"                    if intento < 3:\\n\",\n    \"                        print(f\\\"\u26a0\ufe0f Error en env\u00edo. Reintentando... ({str(e)})\\\")\\n\",\n    \"                        time.sleep(5)  # Esperar antes de reintentar\\n\",\n    \"                        continue\\n\",\n    \"                    else:\\n\",\n    \"                        raise\\n\",\n    \"\\n\",\n    \"            # Pausa para evitar sobrecarga\\n\",\n    \"            print(f\\\"\u23f3 Esperando {pausa_entre_envios} segundos antes del pr\u00f3ximo env\u00edo...\\\")\\n\",\n    \"            time.sleep(pausa_entre_envios)\\n\",\n    \"\\n\",\n    \"        except smtplib.SMTPDataError as e:\\n\",\n    \"            if \\\"Daily user sending limit exceeded\\\" in str(e):\\n\",\n    \"                print(\\\"\u26d4 ERROR CR\u00cdTICO: L\u00edmite diario excedido\\\")\\n\",\n    \"                print(\\\"\ud83d\uded1 Deteniendo el proceso de env\u00edo\\\")\\n\",\n    \"                fallidos += 1\\n\",\n    \"                errores_envio += 1\\n\",\n    \"                break\\n\",\n    \"            else:\\n\",\n    \"                fallidos += 1\\n\",\n    \"                errores_envio += 1\\n\",\n    \"                print(f\\\"\u274c ERROR EN ENV\u00cdO: {str(e)}\\\")\\n\",\n    \"                print(f\\\"\ud83d\udee0\ufe0f Detalles t\u00e9cnicos:\\\\n{traceback.format_exc()}\\\")\\n\",\n    \"        except Exception as e:\\n\",\n    \"            fallidos += 1\\n\",\n    \"            errores_envio += 1\\n\",\n    \"            print(f\\\"\u274c ERROR EN ENV\u00cdO: {str(e)}\\\")\\n\",\n    \"            print(f\\\"\ud83d\udee0\ufe0f Detalles t\u00e9cnicos:\\\\n{traceback.format_exc()}\\\")\\n\",\n    \"\\n\",\n    \"except Exception as e:\\n\",\n    \"    print(f\\\"\u274c ERROR CR\u00cdTICO EN EL SISTEMA: {str(e)}\\\")\\n\",\n    \"    print(f\\\"\ud83d\udee0\ufe0f Detalles t\u00e9cnicos:\\\\n{traceback.format_exc()}\\\")\\n\",\n    \"\\n\",\n    \"finally:\\n\",\n    \"    # Cerrar conexi\u00f3n SMTP de forma segura\\n\",\n    \"    try:\\n\",\n    \"        server.quit()\\n\",\n    \"        print(\\\"\ud83d\udd12 CONEXI\u00d3N SMTP CERRADA\\\")\\n\",\n    \"    except:\\n\",\n    \"        pass\\n\",\n    \"\\n\",\n    \"# Reporte final\\n\",\n    \"print(\\\"\\\\n\ud83d\udcca REPORTE FINAL DE ENV\u00cdOS\\\")\\n\",\n    \"print(f\\\"\u2705 CORREOS EXITOSOS: {exitosos}/{len(df_departamento)}\\\")\\n\",\n    \"print(f\\\"\u274c CORREOS FALLIDOS: {fallidos}/{len(df_departamento)}\\\")\\n\",\n    \"print(f\\\"\ud83d\udcce ERRORES DE ARCHIVO: {errores_archivos}\\\")\\n\",\n    \"print(f\\\"\u2709\ufe0f  ERRORES DE ENV\u00cdO: {errores_envio}\\\")\\n\",\n    \"print(f\\\"\ud83d\udc64 DESTINATARIOS ENVIADOS: {destinatarios_enviados}/{limite_destinatarios}\\\")\\n\",\n    \"\\n\",\n    \"if fallidos == 0 and errores_archivos == 0:\\n\",\n    \"    print(\\\"\\\\n\ud83c\udf89 \u00a1TODOS LOS CORREOS SE ENVIARON EXITOSAMENTE!\\\")\\n\",\n    \"elif fallidos > 0 or errores_archivos > 0:\\n\",\n    \"    print(\\\"\\\\n\u26a0\ufe0f ALGUNOS CORREOS NO PUDIERON ENVIARSE COMPLETAMENTE\\\")\\n\",\n    \"    print(\\\"\u2139\ufe0f Recomendaciones:\\\")\\n\",\n    \"    print(\\\"- Verifica los mensajes de error anteriores\\\")\\n\",\n    \"    print(\\\"- Para correos fallidos, intenta reenviar manualmente\\\")\\n\",\n    \"    print(\\\"- Verifica la existencia de los archivos PDF en: \\\" + periodo_folder)\\n\",\n    \"    print(\\\"- Revisa la configuraci\u00f3n de seguridad de tu cuenta Gmail\\\")\\n\",\n    \"\\n\",\n    \"    if \\\"Daily user sending limit exceeded\\\" in traceback.format_exc():\\n\",\n    \"        print(\\\"\\\\n\ud83d\udd14 IMPORTANTE: Has excedido el l\u00edmite diario de env\u00edos de Gmail\\\")\\n\",\n    \"        print(\\\"\ud83d\udca1 Soluciones:\\\")\\n\",\n    \"        print(\\\"1. Espera 24 horas para que se reinicie tu cuota (se reinicia a medianoche PST)\\\")\\n\",\n    \"        print(\\\"2. Considera usar un servicio profesional como SendGrid para env\u00edos masivos\\\")\\n\",\n    \"        print(\\\"3. Divide los env\u00edos en varios d\u00edas\\\")\\n\",\n    \"        print(\\\"4. Verifica tu actividad de Gmail: https://myaccount.google.com/apppasswords\\\")\"\n   ]\n  }\n ],\n \"metadata\": {\n  \"colab\": {\n   \"provenance\": []\n  },\n  \"kernelspec\": {\n   \"display_name\": \"Python 3\",\n   \"name\": \"python3\"\n  },\n  \"language_info\": {\n   \"name\": \"python\"\n  }\n },\n \"nbformat\": 4,\n \"nbformat_minor\": 0\n}", "type": "text"}, {"name": "requirements.txt", "content": "shiny\npandas\nos\nre\nPdfReader\nPdfWriter\ndrive\ndatetime\ntime\nsmtplib\nMIMEMultipart\nMIMEText\nMIMEApplication\nformatdate\ntraceback", "type": "text"}]